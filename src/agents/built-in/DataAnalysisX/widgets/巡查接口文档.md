# 巡查接口文档

## 上周巡查得分排名前 5 的门店，上周巡查得分排名后 5 的门店

**接口地址**: `POST` `/patrols/actions/queryStoreRank`

**所属分组**: 巡查统计

**版本历史**:

- V2.50.0 出参增加平均重要问题数 `avgImportantQuestionCount`、平均红线问题数 `avgRedQuestionCount`、门店最新一次考评记录 `recordId`（筛选合格才返回）
- V2.48.1 增加 `scoreLevelId` 考评等级id
- V2.35.0 出参新增 `scoreChangeSum`, `scoreChangeAvg`
- V2.27 增加 `storeStatus` 门店状态 (0:未开业, 1:营业, 2:停业, 3:闭店)

### 请求参数

| 参数                     | 类型          | 必填 | 描述                                                                            |
| ------------------------ | ------------- | ---- | ------------------------------------------------------------------------------- |
| `patrolType`           | number        | 否   | 0:考评; 1:点检，默认0                                                           |
| `startDate`            | string        | 是   | 起始日期(格式:yyyy-MM-dd)                                                       |
| `endDate`              | string        | 是   | 结束日期(格式:yyyy-MM-dd)                                                       |
| `templateId`           | string        | 是   | 模板id                                                                          |
| `rateStart`            | integer       | 是   | 得分率范围开始值(>=0)                                                           |
| `rateEnd`              | integer       | 是   | 得分率范围结束值(<=100)                                                         |
| `from`                 | integer       | 是   | 每页起始数据标号，第一页为0                                                     |
| `size`                 | integer       | 是   | 每页条数                                                                        |
| `sortOrder`            | string        | 是   | 排序方向: asc顺序/desc倒序                                                      |
| `sortField`            | string        | 否   | 排序字段: score-得分率/avgScore-平均得分/avgQuestionCount-平均问题数，默认score |
| `type`                 | string        | 否   | 排名类型: top10/last10                                                          |
| `storeId`              | string        | 否   | 门店id                                                                          |
| `storeIdList`          | array[string] | 否   | 多门店id                                                                        |
| `areaId`               | string        | 否   | 区域id                                                                          |
| `areaIdList`           | array[string] | 否   | 多区域id                                                                        |
| `scoreLevelId`         | string        | 否   | 考评等级id                                                                      |
| `storeStatus`          | number        | 否   | 门店状态: 0未开业/1营业/2停业/3闭店                                             |
| `patrolOrganizationId` | string        | 否   | 巡查组织id                                                                      |
| `patrolPersonName`     | string        | 否   | 巡查人名称                                                                      |
| `planConfigId`         | string        | 否   | 巡查计划id                                                                      |

### 响应参数

| 参数                                             | 类型    | 描述                     |
| ------------------------------------------------ | ------- | ------------------------ |
| `code`                                         | integer | 消息码                   |
| `message`                                      | string  | 提示信息                 |
| `success`                                      | boolean | 是否正常返回             |
| `data`                                         | object  | 数据对象                 |
| `data.totalCount`                              | integer | 总数                     |
| `data.storeEvaluations`                        | array   | 门店考评列表             |
| `storeEvaluations[].storeId`                   | string  | 门店id                   |
| `storeEvaluations[].storeName`                 | string  | 门店名称                 |
| `storeEvaluations[].score`                     | number  | 得分率                   |
| `storeEvaluations[].avgScore`                  | number  | 平均得分                 |
| `storeEvaluations[].avgQuestionCount`          | number  | 平均问题数               |
| `storeEvaluations[].avgImportantQuestionCount` | number  | 平均重要问题数           |
| `storeEvaluations[].avgRedQuestionCount`       | number  | 平均红线问题数           |
| `storeEvaluations[].scoreChangeSum`            | number  | 总扣分(点检)             |
| `storeEvaluations[].scoreChangeAvg`            | number  | 平均扣分(点检)           |
| `storeEvaluations[].recordId`                  | string  | 门店最新的一条考评记录id |

### 请求示例

```json
{
  "patrolType": 0,
  "startDate": "2024-01-01",
  "endDate": "2024-01-31",
  "templateId": "2345rgdfASDGATRE",
  "rateStart": 0,
  "rateEnd": 100,
  "from": 0,
  "size": 10,
  "sortOrder": "desc",
  "sortField": "score",
  "type": "top10"
}
```

---

## 上周出现次数最多的5个问题项，上周出现次数最少的5个问题项

**接口地址**: `POST` `/patrols/template/question`

**所属分组**: 巡查模板报表

### 请求参数

| 参数                     | 类型          | 必填 | 描述                                |
| ------------------------ | ------------- | ---- | ----------------------------------- |
| `patrolType`           | number        | 否   | 考评类型(0:考评;1:点检)，默认0      |
| `startDate`            | string        | 否   | 起始日期(yyyy-MM-dd)                |
| `endDate`              | string        | 否   | 结束日期(yyyy-MM-dd)                |
| `patrolTemplateId`     | string        | 否   | 巡查模板id                          |
| `questionIdList`       | array[string] | 否   | 问题项列表                          |
| `storeIdList`          | array         | 否   | 门店id列表                          |
| `areaIdList`           | array         | 否   | 区域id列表                          |
| `patrolOrganizationId` | string        | 否   | 巡查组织id                          |
| `patrolPersonName`     | string        | 否   | 巡查人名称                          |
| `planConfigId`         | string        | 否   | 巡查计划id                          |
| `roleIds`              | array         | 否   | 职位列表                            |
| `storeStatus`          | object        | 否   | 门店状态                            |
| `columnList`           | array         | 否   | 自定义展示指标                      |
| `pageNo`               | number        | 否   | 页码，默认1                         |
| `pageSize`             | number        | 否   | 每页条数，默认10                    |
| `orderFlag`            | number        | 否   | 排序标志: 1-降序, 0-顺序            |
| `orderField`           | string        | 否   | 排序字段: 如 "05001" 表示不合格次数 |

### 响应参数

| 参数        | 类型    | 描述         |
| ----------- | ------- | ------------ |
| `code`    | number  | 消息码       |
| `message` | string  | 提示信息     |
| `success` | boolean | 是否正常返回 |
| `data`    | object  | 返回包体     |

### 请求示例

```json
{
  "patrolType": 0,
  "startDate": "2024-02-05",
  "endDate": "2024-02-05",
  "patrolTemplateId": "template123",
  "questionIdList": ["question1", "question2"],
  "storeIdList": ["store1", "store2"],
  "areaIdList": ["area1"],
  "patrolOrganizationId": "org123",
  "patrolPersonName": "张三",
  "planConfigId": "plan123",
  "roleIds": ["role1"],
  "storeStatus": {},
  "columnList": [],
  "pageNo": 1,
  "pageSize": 10,
  "orderFlag": 1,
  "orderField": "05001"
}
```

### 响应示例

```json
{
  "code": 0,
  "message": "success",
  "success": true,
  "data": {}
}
```

### 响应示例

```json
{
  "code": 200,
  "message": "success",
  "success": true,
  "data": {
    "totalCount": 100,
    "storeEvaluations": [
      {
        "storeId": "adfaa43254fdg",
        "storeName": "示例门店",
        "score": 95.5,
        "avgScore": 92.3,
        "avgQuestionCount": 5.2,
        "avgImportantQuestionCount": 1.5,
        "avgRedQuestionCount": 0.3,
        "scoreChangeSum": -10,
        "scoreChangeAvg": -2,
        "recordId": "record123"
      }
    ]
  }
}
```


查询组织根节点接口
https://pbchain.hik-cloud.com/v1/chain/basic/areas/actions/findAreaStoreTree
get

响应
{
    "code": 0,
    "message": null,
    "data": {
        "nodeList": [
            {
                "nodeType": 0,
                "nodeId": "d4b990d179bb46fda4d3030b90e345bb",
                "nodeName": "测试团队21",
                "parentId": "",
                "path": "/d4b990d179bb46fda4d3030b90e345bb/",
                "pathName": "/测试团队21/",
                "disable": false
            }
        ]
    },
    "success": true
}



接口

https://pbchain.hik-cloud.com/v1/chain/basic/areas/actions/findAreaStoreTree GET
返回值
{
    "code": 0,
    "message": null,
    "data": {
        "nodeList": [
            {
                "nodeType": 0,
                "nodeId": "d4b990d179bb46fda4d3030b90e345bb",
                "nodeName": "测试团队21",
                "parentId": "",
                "path": "/d4b990d179bb46fda4d3030b90e345bb/",
                "pathName": "/测试团队21/",
                "disable": false
            }
        ]
    },
    "success": true
}
