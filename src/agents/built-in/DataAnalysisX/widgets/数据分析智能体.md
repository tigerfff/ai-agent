# 数据分析智能体接口文档

## 查发生不合格问题次数最多的问题

### 基本信息

- **接口名称**：查发生不合格问题次数最多的问题
- **请求方式**：POST
- **请求地址**：`/aiAgent/actions/queryPatrolAgentMostQuestion`
- **所属分组**：数据分析智能体工具接口
- **服务版本**：V2.0.0

### 请求参数

| 参数      | 类型   | 是否必须 | 描述               |
| --------- | ------ | -------- | ------------------ |
| offLine   | number | 否       | 线上、线下         |
| startTime | number | 是       | 开始时间戳，毫秒数 |
| endTime   | number | 是       | 结束时间戳，毫秒数 |

### 响应参数

| 参数              | 类型    | 是否必须 | 描述                       |
| ----------------- | ------- | -------- | -------------------------- |
| code              | number  | 是       | 消息码，默认0              |
| success           | boolean | 是       | 是否正常返回，默认true     |
| message           | string  | 是       | 提示信息，主要用于开发调试 |
| data              | object  | 是       | 返回包体                   |
| data.questionId   | string  | 否       | 问题ID                     |
| data.questionName | string  | 否       | 问题名称                   |

### 响应示例

```json
{
  "code": 0,
  "success": true,
  "message": "操作成功",
  "data": {
    "questionId": "123456",
    "questionName": "员工着装不规范"
  }
}
```

---

## topN问题概览

### 基本信息

- **接口名称**：topN问题概览
- **请求方式**：POST
- **请求地址**：`/aiAgent/actions/queryPatrolAgentStoreQuestionData`
- **所属分组**：数据分析智能体工具接口
- **服务版本**：V2.0.0

### 请求参数

| 参数      | 类型   | 是否必须 | 描述               |
| --------- | ------ | -------- | ------------------ |
| startTime | number | 是       | 开始时间戳，毫秒数 |
| endTime   | number | 是       | 结束时间戳，毫秒数 |

### 响应参数

| 参数                              | 类型          | 是否必须 | 描述                       |
| --------------------------------- | ------------- | -------- | -------------------------- |
| code                              | number        | 是       | 消息码，默认0              |
| success                           | boolean       | 是       | 是否正常返回，默认true     |
| message                           | string        | 是       | 提示信息，主要用于开发调试 |
| data                              | array[object] | 是       | 返回包体                   |
| data.storeId                      | string        | 否       | 门店ID                     |
| data.storeName                    | string        | 否       | 门店名称                   |
| data.questionData                 | array[object] | 否       | topN问题概览               |
| data.questionData[].questionId    | string        | 否       | 问题ID                     |
| data.questionData[].questionName  | string        | 否       | 问题名称                   |
| data.questionData[].questionCount | number        | 否       | 发生次数                   |

### 响应示例

```json
{
  "code": 0,
  "success": true,
  "message": "操作成功",
  "data": [
    {
      "storeId": "1001",
      "storeName": "北京朝阳店",
      "questionData": [
        {
          "questionId": "123456",
          "questionName": "员工着装不规范",
          "questionCount": 15
        },
        {
          "questionId": "123457",
          "questionName": "卫生清洁不到位",
          "questionCount": 10
        }
      ]
    }
  ]
}
```

---

## 查看topN问题图片

### 基本信息

- **接口名称**：查看topN问题图片
- **请求方式**：POST
- **请求地址**：`/aiAgent/actions/queryPatrolAgentStoreQuestionPics`
- **所属分组**：数据分析智能体工具接口
- **服务版本**：V2.0.0

### 请求参数

| 参数        | 类型          | 是否必须 | 描述               |
| ----------- | ------------- | -------- | ------------------ |
| startTime   | number        | 是       | 开始时间戳，毫秒数 |
| endTime     | number        | 是       | 结束时间戳，毫秒数 |
| questionIds | array[string] | 是       | 问题项ID（s）      |
| storeId     | string        | 是       | 门店ID             |

### 响应参数

| 参数                                 | 类型          | 是否必须 | 描述                       |
| ------------------------------------ | ------------- | -------- | -------------------------- |
| code                                 | number        | 是       | 消息码，默认0              |
| success                              | boolean       | 是       | 是否正常返回，默认true     |
| message                              | string        | 是       | 提示信息，主要用于开发调试 |
| data                                 | array[object] | 是       | 返回包体                   |
| data.questionId                      | string        | 否       | 问题项ID                   |
| data.pics                            | array[object] | 否       | 图片列表                   |
| data.pics[].picUrl                   | string        | 否       | 图片URL                    |
| data.pics[].picOrder                 | number        | 否       | 图片顺序编号               |
| data.pics[].captureTime              | number        | 否       | 图片时间                   |
| data.pics[].recordTime               | number        | 否       | 图片所属考评/点检时间      |
| data.pics[].sourceType               | number        | 否       | 图片类型，0抓图，1拍照     |
| data.pics[].channelId                | string        | 否       | 通道ID                     |
| data.pics[].channelName              | string        | 否       | 通道名称                   |
| data.pics[].patrolId                 | string        | 否       | 考评/点检ID                |
| data.pics[].picCoordinate            | string        | 否       | 涂鸦信息                   |
| data.pics[].aiPicCoordinate          | string        | 否       | ai分析框                   |
| data.pics[].multiAnalysisAreaPolygon | string        | 否       | 区域框                     |

### 响应示例

```json
{
  "code": 0,
  "success": true,
  "message": "操作成功",
  "data": [
    {
      "questionId": "123456",
      "pics": [
        {
          "picUrl": "https://example.com/image1.jpg",
          "picOrder": 1,
          "captureTime": 1705094400000,
          "recordTime": 1705094400000,
          "sourceType": 0,
          "channelId": "ch001",
          "channelName": "摄像头1",
          "patrolId": "patrol001",
          "picCoordinate": "[[100,100],[200,200]]",
          "aiPicCoordinate": "[[110,110],[190,190]]",
          "multiAnalysisAreaPolygon": "[[100,100],[200,100],[200,200],[100,200]]"
        }
      ]
    }
  ]
}
```

/v1/chain/statistic/patrols/template/question 查询问题前五后屋，问题最多入参demo
{"pageNo":1,"pageSize":20,"startDate":"2026-01-12","endDate":"2026-01-17","areaIdList":["d4b990d179bb46fda4d3030b90e345bb"],"storeIdList":[],"patrolTemplateId":"06b695ef7bf74bf2a9f4dde08e44eff0","planConfigId":"","patrolOrganizationId":"","patrolPersonName":"","roleIds":[],"storeStatus":"","storeType":"","patrolType":0,"columnList":[5017,5018,5103,5104,5105,5106,5001,5002,5003,5004,5005,5006],"questionIdList":[],"filterCondition":0,"questionType":0,"orderField":"05001","orderFlag":-1}

问题最少入参demo

{"pageNo":1,"pageSize":20,"startDate":"2026-01-12","endDate":"2026-01-17","areaIdList":["d4b990d179bb46fda4d3030b90e345bb"],"storeIdList":[],"patrolTemplateId":"06b695ef7bf74bf2a9f4dde08e44eff0","planConfigId":"","patrolOrganizationId":"","patrolPersonName":"","roleIds":[],"storeStatus":"","storeType":"","patrolType":0,"columnList":[5017,5018,5103,5104,5105,5106,5001,5002,5003,5004,5005,5006],"questionIdList":[],"filterCondition":0,"questionType":0,"orderField":"05001","orderFlag":1}

返回信息{
    "code": 0,
    "message": null,
    "data": {
        "pageNo": 1,
        "pageSize": 20,
        "totalPage": 1,
        "total": 7,
        "hasNextPage": false,
        "hasPreviousPage": false,
        "firstPage": true,
        "lastPage": true,
        "rows": [
            {
                "questionId": "499b2b2ad0a4411ea0db09a5298417ec",
                "questionName": "红线问题",
                "sortNo": "99999",
                "questionType": "0",
                "scoreType": "2",
                "pointType": "0",
                "itemId": "--",
                "itemName": "巡查项2",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "999多发几个文化认同请问让3",
                "groupSortNo": "99999",
                "questionScore": "1.00",
                "scoreChangeAvg": "0.00",
                "inspectionScoreChangeAvg": "0.00",
                "checkCount": "1",
                "questionPassAndNotPassCount": "1",
                "questionPassCount": "1",
                "questionCount": "0",
                "questionRate": "0%",
                "needRectifyQuestionCount": "0",
                "needRectifyQuestionRate": "0%",
                "rectifyCompleteQuestionCount": "0",
                "rectifyCompleteRate": "0%",
                "normalRectifyCompleteQuestionCount": "0",
                "normalRectifyCompleteQuestionRate": "0%",
                "overDeadlineQuestionCount": "0",
                "overDeadlineQuestionRate": "0%",
                "rectifiesCount": "0",
                "normalRectifiesCount": "0",
                "overDeadlineRectifiesCount": "0",
                "reviewsCount": "0",
                "normalReviewsCount": "0",
                "overDeadlineReviewsCount": "0",
                "questionRectifyPassCount": "0",
                "questionRectifyNotPassCount": "0",
                "questionRectifyPassRate": "0%",
                "questionRectifyNotPassRate": "0%",
                "questionRectifyNotCompleteCount": "0"
            },
            {
                "questionId": "f6ffca9e65a44accbdecd5ccfe9769ef",
                "questionName": "问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题1问题11问题1问题11问题1问题1",
                "sortNo": "99999",
                "questionType": "2",
                "scoreType": "0",
                "pointType": "1",
                "itemId": "--",
                "itemName": "加分项",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "额外类123",
                "groupSortNo": "99999",
                "questionScore": "0.00",
                "scoreChangeAvg": "0.00",
                "inspectionScoreChangeAvg": "0.00",
                "checkCount": "0",
                "questionPassAndNotPassCount": "0",
                "questionPassCount": "0",
                "questionCount": "0",
                "questionRate": "0%",
                "needRectifyQuestionCount": "0",
                "needRectifyQuestionRate": "0%",
                "rectifyCompleteQuestionCount": "0",
                "rectifyCompleteRate": "0%",
                "normalRectifyCompleteQuestionCount": "0",
                "normalRectifyCompleteQuestionRate": "0%",
                "overDeadlineQuestionCount": "0",
                "overDeadlineQuestionRate": "0%",
                "rectifiesCount": "0",
                "normalRectifiesCount": "0",
                "overDeadlineRectifiesCount": "0",
                "reviewsCount": "0",
                "normalReviewsCount": "0",
                "overDeadlineReviewsCount": "0",
                "questionRectifyPassCount": "0",
                "questionRectifyNotPassCount": "0",
                "questionRectifyPassRate": "0%",
                "questionRectifyNotPassRate": "0%",
                "questionRectifyNotCompleteCount": "0"
            },
            {
                "questionId": "e7c2298d3ae944cd9db330ee2dfa1425",
                "questionName": "画面有人就不合格",
                "sortNo": "99999",
                "questionType": "0",
                "scoreType": "0",
                "pointType": "0",
                "itemId": "--",
                "itemName": "巡查项123123123",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "999多发几个文化认同请问让3",
                "groupSortNo": "99999",
                "questionScore": "1.00",
                "scoreChangeAvg": "-1.00",
                "inspectionScoreChangeAvg": "-1.00",
                "checkCount": "2",
                "questionPassAndNotPassCount": "2",
                "questionPassCount": "1",
                "questionCount": "1",
                "questionRate": "50%",
                "needRectifyQuestionCount": "1",
                "needRectifyQuestionRate": "100%",
                "rectifyCompleteQuestionCount": "0",
                "rectifyCompleteRate": "0%",
                "normalRectifyCompleteQuestionCount": "0",
                "normalRectifyCompleteQuestionRate": "0%",
                "overDeadlineQuestionCount": "0",
                "overDeadlineQuestionRate": "0%",
                "rectifiesCount": "0",
                "normalRectifiesCount": "0",
                "overDeadlineRectifiesCount": "0",
                "reviewsCount": "1",
                "normalReviewsCount": "1",
                "overDeadlineReviewsCount": "0",
                "questionRectifyPassCount": "0",
                "questionRectifyNotPassCount": "0",
                "questionRectifyPassRate": "0%",
                "questionRectifyNotPassRate": "0%",
                "questionRectifyNotCompleteCount": "0"
            },
            {
                "questionId": "b7dc23fc02ec4c389e30f3daafbbe423",
                "questionName": "画面上有人即不合格",
                "sortNo": "99999",
                "questionType": "0",
                "scoreType": "1",
                "pointType": "0",
                "itemId": "--",
                "itemName": "巡查项123123123",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "999多发几个文化认同请问让3",
                "groupSortNo": "99999",
                "questionScore": "1.00",
                "scoreChangeAvg": "-1.00",
                "inspectionScoreChangeAvg": "-1.00",
                "checkCount": "1",
                "questionPassAndNotPassCount": "1",
                "questionPassCount": "0",
                "questionCount": "1",
                "questionRate": "100%",
                "needRectifyQuestionCount": "1",
                "needRectifyQuestionRate": "100%",
                "rectifyCompleteQuestionCount": "0",
                "rectifyCompleteRate": "0%",
                "normalRectifyCompleteQuestionCount": "0",
                "normalRectifyCompleteQuestionRate": "0%",
                "overDeadlineQuestionCount": "0",
                "overDeadlineQuestionRate": "0%",
                "rectifiesCount": "1",
                "normalRectifiesCount": "1",
                "overDeadlineRectifiesCount": "0",
                "reviewsCount": "0",
                "normalReviewsCount": "0",
                "overDeadlineReviewsCount": "0",
                "questionRectifyPassCount": "0",
                "questionRectifyNotPassCount": "0",
                "questionRectifyPassRate": "0%",
                "questionRectifyNotPassRate": "0%",
                "questionRectifyNotCompleteCount": "0"
            },
            {
                "questionId": "40a5efb5897148828c666536bd42b955",
                "questionName": "画面有人则不合格",
                "sortNo": "99999",
                "questionType": "0",
                "scoreType": "2",
                "pointType": "0",
                "itemId": "--",
                "itemName": "巡查项123123123",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "999多发几个文化认同请问让3",
                "groupSortNo": "99999",
                "questionScore": "2.00",
                "scoreChangeAvg": "-2.00",
                "inspectionScoreChangeAvg": "-2.00",
                "checkCount": "2",
                "questionPassAndNotPassCount": "2",
                "questionPassCount": "0",
                "questionCount": "2",
                "questionRate": "100%",
                "needRectifyQuestionCount": "2",
                "needRectifyQuestionRate": "100%",
                "rectifyCompleteQuestionCount": "0",
                "rectifyCompleteRate": "0%",
                "normalRectifyCompleteQuestionCount": "0",
                "normalRectifyCompleteQuestionRate": "0%",
                "overDeadlineQuestionCount": "0",
                "overDeadlineQuestionRate": "0%",
                "rectifiesCount": "1",
                "normalRectifiesCount": "1",
                "overDeadlineRectifiesCount": "0",
                "reviewsCount": "1",
                "normalReviewsCount": "1",
                "overDeadlineReviewsCount": "0",
                "questionRectifyPassCount": "0",
                "questionRectifyNotPassCount": "0",
                "questionRectifyPassRate": "0%",
                "questionRectifyNotPassRate": "0%",
                "questionRectifyNotCompleteCount": "0"
            },
            {
                "questionId": "18657574cf2b42cca8baeb410781d98e",
                "questionName": "画面无人",
                "sortNo": "99999",
                "questionType": "0",
                "scoreType": "1",
                "pointType": "0",
                "itemId": "--",
                "itemName": "巡查项123123123",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "999多发几个文化认同请问让3",
                "groupSortNo": "99999",
                "questionScore": "4.00",
                "scoreChangeAvg": "-4.00",
                "inspectionScoreChangeAvg": "-4.00",
                "checkCount": "2",
                "questionPassAndNotPassCount": "2",
                "questionPassCount": "0",
                "questionCount": "2",
                "questionRate": "100%",
                "needRectifyQuestionCount": "2",
                "needRectifyQuestionRate": "100%",
                "rectifyCompleteQuestionCount": "0",
                "rectifyCompleteRate": "0%",
                "normalRectifyCompleteQuestionCount": "0",
                "normalRectifyCompleteQuestionRate": "0%",
                "overDeadlineQuestionCount": "0",
                "overDeadlineQuestionRate": "0%",
                "rectifiesCount": "1",
                "normalRectifiesCount": "1",
                "overDeadlineRectifiesCount": "0",
                "reviewsCount": "1",
                "normalReviewsCount": "1",
                "overDeadlineReviewsCount": "0",
                "questionRectifyPassCount": "0",
                "questionRectifyNotPassCount": "0",
                "questionRectifyPassRate": "0%",
                "questionRectifyNotPassRate": "0%",
                "questionRectifyNotCompleteCount": "0"
            },
            {
                "questionId": "59a0fab427414419a8e194e35f0ea9d9",
                "questionName": "巡查问题1",
                "sortNo": "99999",
                "questionType": "0",
                "scoreType": "0",
                "pointType": "0",
                "itemId": "--",
                "itemName": "111",
                "itemSortNo": "99999",
                "groupId": "--",
                "groupName": "大类2",
                "groupSortNo": "99999",
                "questionScore": "1.00",
                "scoreChangeAvg": "--",
                "inspectionScoreChangeAvg": "--",
                "checkCount": "--",
                "questionPassAndNotPassCount": "--",
                "questionPassCount": "--",
                "questionCount": "--",
                "questionRate": "--",
                "needRectifyQuestionCount": "--",
                "needRectifyQuestionRate": "--",
                "rectifyCompleteQuestionCount": "--",
                "rectifyCompleteRate": "--",
                "normalRectifyCompleteQuestionCount": "--",
                "normalRectifyCompleteQuestionRate": "--",
                "overDeadlineQuestionCount": "--",
                "overDeadlineQuestionRate": "--",
                "rectifiesCount": "--",
                "normalRectifiesCount": "--",
                "overDeadlineRectifiesCount": "--",
                "reviewsCount": "--",
                "normalReviewsCount": "--",
                "overDeadlineReviewsCount": "--",
                "questionRectifyPassCount": "--",
                "questionRectifyNotPassCount": "--",
                "questionRectifyPassRate": "--",
                "questionRectifyNotPassRate": "--",
                "questionRectifyNotCompleteCount": "0"
            }
        ]
    },
    "success": true
}
