{"version":3,"file":"form.esm.js","sources":["../oss-form-uploader.js"],"sourcesContent":["/**\n * OSS 表单上传器\n * 封装了阿里云 OSS 的表单上传（POST）流程。\n * 该类不依赖于 STSProvider，凭证信息需从外部传入。\n * 支持：文件 SM4 加密、Base64 转换、表单提交。\n */\n\nimport { sm4 } from 'sec-crypto'\nimport { v4 as uuidv4 } from 'uuid';\n\n/**\n * 读取 File 为 ArrayBuffer\n */\nasync function readFileAsArrayBuffer(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = reject;\n    reader.readAsArrayBuffer(file);\n  });\n}\n\n/**\n * Base64 转 HEX\n */\nfunction base64toHEX(base64) {\n  const raw = window.atob(base64);\n  let HEX = \"\";\n  for (let i = 0; i < raw.length; i++) {\n    const _hex = raw.charCodeAt(i).toString(16);\n    HEX += _hex.length === 2 ? _hex : \"0\" + _hex;\n  }\n  return HEX;\n}\n\n/**\n * DataURL (Base64) 转 Blob\n */\nfunction dataURLtoBlob(dataurl) {\n  if (!dataurl || typeof dataurl !== 'string') {\n    throw new Error('dataURLtoBlob: dataurl must be a non-empty string');\n  }\n  \n  const arr = dataurl.split(\",\");\n  if (arr.length < 2) {\n    throw new Error('dataURLtoBlob: invalid data URL format, missing comma separator');\n  }\n  \n  const mimeMatch = arr[0].match(/:(.*?);/);\n  if (!mimeMatch || !mimeMatch[1]) {\n    throw new Error('dataURLtoBlob: invalid data URL format, missing MIME type');\n  }\n  \n  const mime = mimeMatch[1];\n  const bstr = window.atob(arr[1]);\n  let n = bstr.length;\n  const u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  return new Blob([u8arr], { type: mime });\n}\n\n/**\n * 使用 SM4 对二进制数据加密\n */\nfunction sm4Encrypt(arrayBuffer, kmsDataKey) {\n  const bytes = new Uint8Array(arrayBuffer);\n  const hexData = Array.from(bytes)\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n\n  const hexDataKey = base64toHEX(kmsDataKey.dataKey);\n\n  const encryptedHex = sm4.encrypt(hexData, hexDataKey.slice(0, 32), {\n    iv: hexDataKey.slice(32, 64),\n    mode: \"cbc\",\n  });\n\n  const result = new Uint8Array(\n    encryptedHex.match(/[\\da-f]{2}/gi).map((h) => parseInt(h, 16))\n  );\n\n  return result;\n}\n\n/**\n * 将 File 加密后构造新的 Blob\n */\nasync function createEncryptedBlob(file, { kmsDataKey }) {\n  const arrayBuffer = await readFileAsArrayBuffer(file);\n  const encryptedData = sm4Encrypt(arrayBuffer, kmsDataKey);\n  return new Blob([encryptedData], { type: file.type });\n}\n\nexport class OssFormUploader {\n  /**\n   * 上传单个文件 (使用表单 POST 模式)\n   * @param {File|Blob|string} file - 要上传的文件 (File, Blob, 或 Base64 字符串)\n   * @param {Object} stsData - 从后端获取的表单上传凭证\n   * @param {Object} options - 配置项\n   * @param {string} options.fileName - 自定义文件名\n   * @param {boolean} options.strictNameMode - 严格名称（如果为 true 且提供了 fileName，则直接使用 fileName）\n   * @param {boolean} options.allowHTML - 是否允许上传 HTML 文件\n   * @returns {Promise<Object>} 上传结果\n   */\n  async upload(file, stsData, options = {}) {\n    if (!file || !stsData) {\n      throw new Error(\"OssFormUploader: file and stsData are required\");\n    }\n\n    try {\n      // 0. 归一化输入：如果是 base64 字符串，转换为 Blob\n      let normalizedFile = file;\n      if (typeof file === \"string\" && file.startsWith(\"data:\")) {\n        normalizedFile = dataURLtoBlob(file);\n      }\n\n      // --- 新增：HTML 文件校验逻辑 ---\n      const checkName = normalizedFile.name || \"\";\n      const checkType = normalizedFile.type || \"\";\n      const isHtml = checkName.toLowerCase().endsWith('.html') || \n                     checkName.toLowerCase().endsWith('.htm') || \n                     checkType === 'text/html';\n\n      if (isHtml && !options.allowHTML) {\n        const errorMsg = \"暂不支持上传 HTML 格式文件\";\n        if (typeof window !== 'undefined' && window.alert) {\n          window.alert(errorMsg);\n        }\n        throw new Error(`OssFormUploader: ${errorMsg}`);\n      }\n\n      // 路径处理\n      // 注意：Blob 没有 name 属性，需要处理\n      const originalName = normalizedFile.name || (normalizedFile.type ? `upload.${normalizedFile.type.split('/')[1]}` : \"unnamed\");\n      const fileName = (options.strictNameMode && options.fileName) || this.generateUniqueFileName(originalName, options.fileName);\n      const objectKey = `${stsData.object}/${fileName}`.replace(/\\/+/g, \"/\");\n\n      // 1. 处理文件加密\n      let uploadFile = normalizedFile;\n      let meta = {};\n\n      if (stsData.encryptEnable) {\n        if (stsData.kmsDataKey && stsData.kmsDataKey.sm4Supported) {\n          uploadFile = await createEncryptedBlob(normalizedFile, stsData)\n          meta = {\n            'x-oss-meta-encrypted-version': String(stsData.kmsDataKey.version),\n            'x-oss-meta-encrypted-data-key': String(stsData.kmsDataKey.dataKeyEncrypted),\n            'x-oss-meta-sm4-supported': '1'\n          }\n        } else if (typeof options.externalEncrypt === 'function') {\n          const { encryptedFile, meta: extraMeta } = await options.externalEncrypt(normalizedFile, stsData)\n          uploadFile = encryptedFile\n          if (extraMeta) {\n            Object.keys(extraMeta).forEach(key => {\n              meta[`x-oss-meta-${key}`] = extraMeta[key]\n            })\n          }\n        }\n      }\n\n      // 2. 构造 FormData\n      const formData = new FormData();\n      \n      // 注意：OSS 表单上传字段顺序有要求，file 必须在最后\n      formData.append('key', objectKey);\n      formData.append('policy', stsData.policy);\n      formData.append('OSSAccessKeyId', stsData.accessKeyId);\n      formData.append('success_action_status', '200'); // 让 OSS 返回 200 而不是 204\n      formData.append('signature', stsData.signature);\n      \n      if (stsData.securityToken) {\n        formData.append('x-oss-security-token', stsData.securityToken);\n      }\n\n      // 添加加密元数据\n      Object.keys(meta).forEach(key => {\n        formData.append(key, meta[key]);\n      });\n\n      // 最后添加文件\n      formData.append('file', uploadFile);\n\n      // 3. 执行上传请求\n      const endpoint = stsData.endpoint.replace(/\\/+$/, \"\");\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`OssFormUploader: Upload failed with status ${response.status}. ${errorText}`);\n      }\n\n      // 4. 拼接最终访问地址\n      let finalUrl = \"\";\n      if (stsData.domain) {\n        const domain = stsData.domain.replace(/\\/+$/, \"\");\n        const key = objectKey.replace(/^\\/+/, \"\");\n        finalUrl = `${domain}/${key}`;\n      } else {\n        // 如果没有 domain，尝试从 endpoint 拼接 (仅供参考，生产建议使用 domain)\n        finalUrl = `${endpoint}/${objectKey.replace(/^\\/+/, \"\")}`;\n      }\n\n      // 如果开启了加密，追加访问参数\n      if (stsData.encryptEnable && stsData.kmsDataKey) {\n        const separator = finalUrl.includes(\"?\") ? \"&\" : \"?\";\n        const accessKey = stsData.kmsDataKey.accessKey || \"\";\n        finalUrl = `${finalUrl}${separator}accessKey=${accessKey}&v=1&encrypted=1`;\n      }\n\n      return {\n        url: finalUrl,\n        fileName,\n        stsData\n      };\n\n    } catch (error) {\n      console.error(\"OssFormUploader: Upload failed\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * 上传多个文件\n   * @param {Array<Object>} items - 每个 item 包含 { file, stsData }\n   */\n  async uploadMultiple(items, options = {}) {\n    const promises = items.map((item, index) => {\n      return this.upload(item.file, item.stsData, options);\n    });\n    return Promise.allSettled(promises);\n  }\n\n  /**\n   * 生成唯一文件名\n   */\n  generateUniqueFileName(originalName, fileName) {\n    const randomStr = uuidv4()\n    let ext = originalName.split(\".\").pop();\n    if (ext === 'unnamed' && fileName) {\n      ext = fileName.split(\".\").pop();\n    }\n    return `${randomStr}.${ext}`;\n  }\n}\n\n"],"names":["readFileAsArrayBuffer","_x","_readFileAsArrayBuffer","apply","arguments","_asyncToGenerator","_regenerator","m","_callee3","file","w","_context3","n","a","Promise","resolve","reject","reader","FileReader","onload","result","onerror","readAsArrayBuffer","base64toHEX","base64","raw","window","atob","HEX","i","length","_hex","charCodeAt","toString","dataURLtoBlob","dataurl","Error","arr","split","mimeMatch","match","mime","bstr","u8arr","Uint8Array","Blob","type","sm4Encrypt","arrayBuffer","kmsDataKey","bytes","hexData","Array","from","map","b","padStart","join","hexDataKey","dataKey","encryptedHex","sm4","encrypt","slice","iv","mode","h","parseInt","createEncryptedBlob","_x2","_x3","_createEncryptedBlob","_callee4","_ref","encryptedData","_context4","v","OssFormUploader","_classCallCheck","_createClass","key","value","_upload","_callee","stsData","options","normalizedFile","checkName","checkType","isHtml","errorMsg","originalName","fileName","objectKey","uploadFile","meta","_yield$options$extern","encryptedFile","extraMeta","formData","endpoint","response","errorText","finalUrl","domain","separator","accessKey","_args","_t","_context","p","undefined","startsWith","name","toLowerCase","endsWith","allowHTML","alert","concat","strictNameMode","generateUniqueFileName","object","replace","encryptEnable","sm4Supported","String","version","dataKeyEncrypted","externalEncrypt","Object","keys","forEach","FormData","append","policy","accessKeyId","signature","securityToken","fetch","method","body","ok","text","status","includes","url","console","error","upload","_x4","_x5","_uploadMultiple","_callee2","items","_this","promises","_args2","_context2","item","index","allSettled","uploadMultiple","_x6","randomStr","uuidv4","ext","pop"],"mappings":"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"}