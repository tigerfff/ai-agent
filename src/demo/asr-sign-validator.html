<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASR Sign éªŒè¯å·¥å…·</title>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #555;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    textarea {
      min-height: 100px;
      font-family: monospace;
      resize: vertical;
    }
    button {
      background: #409eff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
    }
    button:hover {
      background: #66b1ff;
    }
    button.secondary {
      background: #909399;
    }
    button.secondary:hover {
      background: #a6a9ad;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #f0f9ff;
      border: 1px solid #b3d8ff;
      border-radius: 4px;
    }
    .result h3 {
      margin-top: 0;
      color: #409eff;
    }
    .result-item {
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 4px;
      word-break: break-all;
    }
    .result-label {
      font-weight: 500;
      color: #666;
      margin-bottom: 5px;
    }
    .result-value {
      color: #333;
      font-family: monospace;
      font-size: 13px;
    }
    .match {
      color: #67c23a;
      font-weight: bold;
    }
    .mismatch {
      color: #f56c6c;
      font-weight: bold;
    }
    .example {
      margin-top: 20px;
      padding: 15px;
      background: #fff7e6;
      border: 1px solid #ffd591;
      border-radius: 4px;
    }
    .example h4 {
      margin-top: 0;
      color: #d46b08;
    }
    .example code {
      display: block;
      padding: 10px;
      background: white;
      border-radius: 4px;
      margin-top: 10px;
      font-size: 12px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” ASR Sign éªŒè¯å·¥å…·</h1>
    
    <div class="form-group">
      <label>SecretKey:</label>
      <input type="text" id="secretKey" value="JPUL5e7NQGuLZcXGm5A4kFYgcLrBKG7l" placeholder="è¯·è¾“å…¥ SecretKey">
    </div>

    <div class="form-group">
      <label>å¾…ç­¾åå­—ç¬¦ä¸² (stringToSign):</label>
      <textarea id="stringToSign" placeholder="ä¾‹å¦‚: asr.cloud.tencent.com/asr/v2/125922***?engine_model_type=16k_zh&expired=1673494772&needvad=1&nonce=1673408372&secretid=*****Qq1zhZMN8dv0******&timestamp=1673408372&voice_format=1&voice_id=c64385ee-3e5c-4fc5-bbfd-7c71addb35b0"></textarea>
    </div>

    <div class="form-group">
      <label>åç«¯è¿”å›çš„ Sign å€¼ (ç”¨äºå¯¹æ¯”):</label>
      <input type="text" id="backendSign" placeholder="ç²˜è´´åç«¯è¿”å›çš„ sign å€¼è¿›è¡Œå¯¹æ¯”">
    </div>

    <button onclick="calculateSign()">è®¡ç®— Sign</button>
    <button class="secondary" onclick="loadExample()">åŠ è½½ç¤ºä¾‹</button>
    <button class="secondary" onclick="clearAll()">æ¸…ç©º</button>

    <div id="result" class="result" style="display: none;">
      <h3>è®¡ç®—ç»“æœ</h3>
      <div class="result-item">
        <div class="result-label">è®¡ç®—å‡ºçš„ Sign:</div>
        <div class="result-value" id="calculatedSign"></div>
      </div>
      <div class="result-item" id="comparison" style="display: none;">
        <div class="result-label">å¯¹æ¯”ç»“æœ:</div>
        <div class="result-value" id="comparisonResult"></div>
      </div>
      <div class="result-item">
        <div class="result-label">è®¡ç®—æ­¥éª¤:</div>
        <div class="result-value" id="steps"></div>
      </div>
    </div>

    <div class="example">
      <h4>ğŸ“ ä½¿ç”¨è¯´æ˜</h4>
      <p>1. è¾“å…¥ SecretKeyï¼ˆå·²é»˜è®¤å¡«å…¥ï¼‰</p>
      <p>2. è¾“å…¥å¾…ç­¾åå­—ç¬¦ä¸²ï¼ˆä» SDK çš„ signCallback ä¸­è·å–ï¼‰</p>
      <p>3. å¯é€‰ï¼šè¾“å…¥åç«¯è¿”å›çš„ Sign å€¼è¿›è¡Œå¯¹æ¯”éªŒè¯</p>
      <p>4. ç‚¹å‡»"è®¡ç®— Sign"æŒ‰é’®</p>
      <p><strong>åŠ å¯†æ–¹æ³•ï¼š</strong></p>
      <code>Base64Encode(HmacSha1(stringToSign, secretKey))</code>
    </div>
  </div>

  <script>
    function calculateSign() {
      const secretKey = document.getElementById('secretKey').value.trim();
      const stringToSign = document.getElementById('stringToSign').value.trim();
      const backendSign = document.getElementById('backendSign').value.trim();

      if (!secretKey) {
        alert('è¯·è¾“å…¥ SecretKey');
        return;
      }

      if (!stringToSign) {
        alert('è¯·è¾“å…¥å¾…ç­¾åå­—ç¬¦ä¸²');
        return;
      }

      try {
        // æ­¥éª¤1: ä½¿ç”¨ HmacSHA1 åŠ å¯†
        const hmac = CryptoJS.HmacSHA1(stringToSign, secretKey);
        const hmacHex = hmac.toString(CryptoJS.enc.Hex);
        
        // æ­¥éª¤2: Base64 ç¼–ç 
        const hmacBase64 = CryptoJS.enc.Base64.stringify(hmac);
        const calculatedSign = hmacBase64;

        // æ˜¾ç¤ºç»“æœ
        document.getElementById('calculatedSign').textContent = calculatedSign;
        document.getElementById('steps').innerHTML = `
          <div>1. HmacSHA1(stringToSign, secretKey) = ${hmacHex.substring(0, 40)}...</div>
          <div>2. Base64Encode(hmac) = ${calculatedSign}</div>
        `;

        // å¦‚æœæœ‰åç«¯è¿”å›çš„ signï¼Œè¿›è¡Œå¯¹æ¯”
        if (backendSign) {
          const match = calculatedSign === backendSign;
          const comparisonDiv = document.getElementById('comparison');
          const comparisonResult = document.getElementById('comparisonResult');
          
          comparisonDiv.style.display = 'block';
          comparisonResult.innerHTML = match 
            ? '<span class="match">âœ… åŒ¹é…ï¼åç«¯è¿”å›çš„ Sign å€¼æ­£ç¡®</span>'
            : '<span class="mismatch">âŒ ä¸åŒ¹é…ï¼åç«¯è¿”å›çš„ Sign å€¼å¯èƒ½æœ‰é—®é¢˜</span>';
        } else {
          document.getElementById('comparison').style.display = 'none';
        }

        document.getElementById('result').style.display = 'block';
      } catch (error) {
        alert('è®¡ç®—å¤±è´¥: ' + error.message);
        console.error(error);
      }
    }

    function loadExample() {
      document.getElementById('stringToSign').value = 'asr.cloud.tencent.com/asr/v2/125922***?engine_model_type=16k_zh&expired=1673494772&needvad=1&nonce=1673408372&secretid=*****Qq1zhZMN8dv0******&timestamp=1673408372&voice_format=1&voice_id=c64385ee-3e5c-4fc5-bbfd-7c71addb35b0';
    }

    function clearAll() {
      document.getElementById('secretKey').value = 'JPUL5e7NQGuLZcXGm5A4kFYgcLrBKG7l';
      document.getElementById('stringToSign').value = '';
      document.getElementById('backendSign').value = '';
      document.getElementById('result').style.display = 'none';
    }

    // æ”¯æŒ Enter é”®è§¦å‘è®¡ç®—
    document.getElementById('stringToSign').addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'Enter') {
        calculateSign();
      }
    });
  </script>
</body>
</html>

